# Architecture: Block Agent System

**Version**: 2.0.0 | **Date**: 2025-12-09 | **Status**: Draft

> ë¡œì§ ë¬´ê²°ì„±ê³¼ ì•± ê´€ë¦¬ ìµœì í™”ë¥¼ ìœ„í•œ ë¸”ëŸ­í™” + ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

---

## ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
   - 1.1 ëª©ì 
   - 1.2 ì„¤ê³„ ì›ì¹™
   - 1.3 ì•„í‚¤í…ì²˜ ê°œìš”
   - **1.4 AI ì»¨í…ìŠ¤íŠ¸ ìµœì í™”** â† NEW
2. [ë¸”ëŸ­ ì •ì˜](#2-ë¸”ëŸ­-ì •ì˜)
   - 2.1 ë¸”ëŸ­ êµ¬ì¡°
   - 2.2 ë„ë©”ì¸ë³„ ë¸”ëŸ­ ë§µ
   - 2.3 ë¸”ëŸ­ ì˜ì¡´ì„± ê·¸ë˜í”„
   - **2.4 Vertical Slicing íŒ¨í„´** â† NEW
   - **2.5 ë¸”ëŸ­ ì‚¬ì´ì¦ˆ ê°€ì´ë“œ** â† NEW
3. [ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ](#3-ì—ì´ì „íŠ¸-ì‹œìŠ¤í…œ)
   - 3.1 ì—ì´ì „íŠ¸ ê³„ì¸µ êµ¬ì¡°
   - 3.2 ì—ì´ì „íŠ¸ ì¸í„°í˜ì´ìŠ¤
   - 3.3 ë„ë©”ì¸ ì—ì´ì „íŠ¸ ìƒì„¸
   - 3.4 ì—ì´ì „íŠ¸-ë¸”ëŸ­ ë§¤í•‘ í…Œì´ë¸”
   - **3.5 Agent Rules íŒŒì¼** â† NEW
4. [ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íŒ¨í„´](#4-ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜-íŒ¨í„´)
   - 4.1 ì±„íƒ íŒ¨í„´
   - 4.2 ì›Œí¬í”Œë¡œìš° ì˜ˆì‹œ
   - 4.3 ë³‘ë ¬ ì²˜ë¦¬ íŒ¨í„´
   - **4.4 Conductor ì›Œí¬í”Œë¡œìš°** â† NEW
5. [í†µì‹  í”„ë¡œí† ì½œ](#5-í†µì‹ -í”„ë¡œí† ì½œ)
6. [ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬](#6-ì—ëŸ¬-ì²˜ë¦¬-ë°-ë³µêµ¬)
7. [êµ¬í˜„ ê°€ì´ë“œ](#7-êµ¬í˜„-ê°€ì´ë“œ)

---

## 1. ê°œìš”

### 1.1 ëª©ì 

| ëª©í‘œ | ì„¤ëª… |
|------|------|
| **ë¡œì§ ë¬´ê²°ì„±** | ë¸”ëŸ­ ê°„ ëª…í™•í•œ ê²½ê³„ë¡œ ë¶€ì‘ìš©(Side Effect) ê²©ë¦¬ |
| **ê´€ë¦¬ ìµœì í™”** | ë¸”ëŸ­ë³„ ì „ë‹´ ì—ì´ì „íŠ¸ë¡œ ì±…ì„ ë¶„ë¦¬ |
| **í™•ì¥ì„±** | ìƒˆ ë¸”ëŸ­/ì—ì´ì „íŠ¸ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì‹œìŠ¤í…œ ì˜í–¥ ìµœì†Œí™” |
| **ë””ë²„ê¹… ìš©ì´ì„±** | ë¬¸ì œ ë°œìƒ ì‹œ í•´ë‹¹ ë¸”ëŸ­/ì—ì´ì „íŠ¸ë§Œ ë¶„ì„ |

### 1.2 ì„¤ê³„ ì›ì¹™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DESIGN PRINCIPLES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Single Responsibility  - í•˜ë‚˜ì˜ ë¸”ëŸ­ì€ í•˜ë‚˜ì˜ ê´€ì‹¬ì‚¬     â”‚
â”‚  2. Loose Coupling         - ë¸”ëŸ­ ê°„ ì¸í„°í˜ì´ìŠ¤ë¡œë§Œ í†µì‹      â”‚
â”‚  3. High Cohesion          - ë¸”ëŸ­ ë‚´ë¶€ëŠ” ê°•í•˜ê²Œ ê²°í•©        â”‚
â”‚  4. Fail Fast              - ì—ëŸ¬ëŠ” ì¦‰ì‹œ ê°ì§€, ë¹ ë¥´ê²Œ ë³µêµ¬  â”‚
â”‚  5. Observable             - ëª¨ë“  ë¸”ëŸ­ ìƒíƒœëŠ” ê´€ì°° ê°€ëŠ¥     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ì•„í‚¤í…ì²˜ ê°œìš”

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Orchestrator   â”‚
                         â”‚     Agent       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                      â”‚                      â”‚
           â–¼                      â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Domain    â”‚       â”‚   Domain    â”‚       â”‚   Domain    â”‚
    â”‚   Agent     â”‚       â”‚   Agent     â”‚       â”‚   Agent     â”‚
    â”‚  (Auth)     â”‚       â”‚  (Content)  â”‚       â”‚  (Stream)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                      â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚   Blocks    â”‚       â”‚   Blocks    â”‚       â”‚   Blocks    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ Validate  â”‚       â”‚ â€¢ Query     â”‚       â”‚ â€¢ Transcode â”‚
    â”‚ â€¢ Token     â”‚       â”‚ â€¢ Search    â”‚       â”‚ â€¢ Deliver   â”‚
    â”‚ â€¢ Session   â”‚       â”‚ â€¢ Cache     â”‚       â”‚ â€¢ Monitor   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 AI ì»¨í…ìŠ¤íŠ¸ ìµœì í™”

ë¸”ëŸ­í™”ê°€ í•„ìš”í•œ ê¸°ìˆ ì  ê·¼ê±°ì…ë‹ˆë‹¤.

#### 1.4.1 ë¬¸ì œ ì§„ë‹¨

ì•±ì˜ ë³¼ë¥¨ì´ ì»¤ì§ˆìˆ˜ë¡ AIì˜ í¼í¬ë¨¼ìŠ¤ê°€ ê¸‰ë½í•˜ëŠ” í˜„ìƒì€ **ê¸°ìˆ ì  í•œê³„**ì— ê¸°ì¸í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI BOTTLENECKS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Context Pollution (ì»¨í…ìŠ¤íŠ¸ ì˜¤ì—¼)                        â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚     ë¬´ê´€í•œ ì½”ë“œê°€ AIì˜ ì¶”ë¡ ì„ ë°©í•´í•©ë‹ˆë‹¤.                     â”‚
â”‚     í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ì‹œ ë°±ì—”ë“œ ì„¤ì • íŒŒì¼ì´ ë…¸ì´ì¦ˆê°€ ë˜ì–´       â”‚
â”‚     í™˜ê°(Hallucination)ì„ ìœ ë°œí•©ë‹ˆë‹¤.                        â”‚
â”‚                                                              â”‚
â”‚  2. Attention Dilution (ì£¼ì˜ë ¥ ë¶„ì‚°)                         â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚     ìµœì‹  LLMì´ 1M í† í°ì„ ì²˜ë¦¬í•œë‹¤ê³  í•´ë„, 'ì§‘ì¤‘ë ¥'ì€          â”‚
â”‚     ì…ë ¥ëŸ‰ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ë–¨ì–´ì§‘ë‹ˆë‹¤.                           â”‚
â”‚     (Lost-in-the-Middle í˜„ìƒ)                                â”‚
â”‚                                                              â”‚
â”‚  3. Scale Threshold (ê·œëª¨ ì„ê³„ì )                            â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚     "ì „ì²´ë¥¼ ë‹¤ ë³´ê³  ì•Œì•„ì„œ ê³ ì³ì¤˜" ë°©ì‹ì€                     â”‚
â”‚     íŒŒì¼ 50ê°œ+ ê·œëª¨ë¶€í„° ì‚¬ì‹¤ìƒ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.4.2 ë¸”ëŸ­í™” íš¨ê³¼

| Before (ë‹¨ì¼ ì»¨í…ìŠ¤íŠ¸) | After (ë¸”ëŸ­í™”) |
|------------------------|----------------|
| ì „ì²´ ì½”ë“œë² ì´ìŠ¤ ë¡œë“œ (500+ íŒŒì¼) | í•´ë‹¹ ë¸”ëŸ­ë§Œ ë¡œë“œ (15~30 íŒŒì¼) |
| ë¬´ê´€í•œ ì½”ë“œë¡œ ì¸í•œ í™˜ê° | ê´€ë ¨ ì½”ë“œë§Œ ì§‘ì¤‘ ë¶„ì„ |
| AI ì‘ë‹µ ì‹œê°„ 10ì´ˆ+ | AI ì‘ë‹µ ì‹œê°„ 2~3ì´ˆ |
| ì˜¤ë¥˜ìœ¨ ë†’ìŒ | ì˜¤ë¥˜ìœ¨ í˜„ì €íˆ ê°ì†Œ |

```
                    AI Performance vs Codebase Size

    Error Rate
    â”‚
    â”‚                                      â•± Without Blocks
    â”‚                                   â•±
    â”‚                                â•±
    â”‚                             â•±
    â”‚                          â•±
    â”‚                       â•±
    â”‚                    â•±
    â”‚                 â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ With Blocks
    â”‚              â•± â•±
    â”‚           â•±  â•±
    â”‚        â•±   â•±
    â”‚     â•±    â•±
    â”‚  â•±     â•±
    â”‚â•±â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
         50      100     200     500    1000   Files
              â†‘
         Threshold
         (ë¸”ëŸ­í™” ê¶Œì¥ ì‹œì )
```

---

## 2. ë¸”ëŸ­ ì •ì˜

### 2.1 ë¸”ëŸ­ êµ¬ì¡°

ë¸”ëŸ­ì€ WSOPTV Monorepoì˜ íŒ¨í‚¤ì§€ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì •ì˜ë©ë‹ˆë‹¤.

```typescript
// types/block.ts
interface Block {
  id: string;                    // 'auth.validate', 'content.query'
  domain: DomainType;            // 'auth' | 'content' | 'stream' | 'search'
  name: string;                  // 'validate', 'query', 'transcode'
  version: string;               // SemVer
  status: BlockStatus;

  // ì˜ì¡´ì„±
  inputs: InputPort[];
  outputs: OutputPort[];

  // ë©”íƒ€ë°ì´í„°
  metadata: {
    description: string;
    owner: string;               // ë‹´ë‹¹ ì—ì´ì „íŠ¸ ID
    tags: string[];
    createdAt: string;
    updatedAt: string;
  };
}

type DomainType = 'auth' | 'content' | 'stream' | 'search' | 'player' | 'admin';
type BlockStatus = 'idle' | 'processing' | 'error' | 'disabled';

interface InputPort {
  name: string;
  type: string;                  // TypeScript íƒ€ì… ë¬¸ìì—´
  required: boolean;
  validator?: string;            // Zod ìŠ¤í‚¤ë§ˆ ì°¸ì¡°
}

interface OutputPort {
  name: string;
  type: string;
  emitsOn: 'success' | 'error' | 'always';
}
```

### 2.2 ë„ë©”ì¸ë³„ ë¸”ëŸ­ ë§µ

#### Auth Domain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AUTH DOMAIN                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   validate   â”‚â”€â”€â”€â–¶â”‚    token     â”‚â”€â”€â”€â–¶â”‚   session    â”‚  â”‚
â”‚  â”‚    Block     â”‚    â”‚    Block     â”‚    â”‚    Block     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                   â”‚          â”‚
â”‚         â–¼                   â–¼                   â–¼          â”‚
â”‚  â€¢ ì…ë ¥ ê²€ì¦          â€¢ JWT ë°œê¸‰           â€¢ ì„¸ì…˜ ê´€ë¦¬     â”‚
â”‚  â€¢ Zod ìŠ¤í‚¤ë§ˆ         â€¢ Refresh ì²˜ë¦¬       â€¢ Redis ì €ì¥    â”‚
â”‚  â€¢ Rate Limit         â€¢ Blacklist          â€¢ ë§Œë£Œ ì²˜ë¦¬     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Block ID | ì±…ì„ | ì…ë ¥ | ì¶œë ¥ |
|----------|------|------|------|
| `auth.validate` | ì¸ì¦ ì •ë³´ ê²€ì¦ | `LoginRequest` | `ValidatedCredentials` |
| `auth.token` | JWT ìƒì„±/ê°±ì‹ /ê²€ì¦ | `ValidatedCredentials` | `TokenPair` |
| `auth.session` | ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬ | `TokenPair` | `SessionState` |

#### Content Domain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTENT DOMAIN                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    query     â”‚â”€â”€â”€â–¶â”‚    cache     â”‚â”€â”€â”€â–¶â”‚   response   â”‚  â”‚
â”‚  â”‚    Block     â”‚    â”‚    Block     â”‚    â”‚    Block     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                   â”‚          â”‚
â”‚         â–¼                   â–¼                   â–¼          â”‚
â”‚  â€¢ DB ì¡°íšŒ             â€¢ Redis ìºì‹œ        â€¢ ì§ë ¬í™”       â”‚
â”‚  â€¢ Eager Loading       â€¢ TTL ê´€ë¦¬          â€¢ í˜ì´ì§€ë„¤ì´ì…˜  â”‚
â”‚  â€¢ í•„í„°/ì •ë ¬           â€¢ ë¬´íš¨í™”            â€¢ í•˜ì´í¼ë¯¸ë””ì–´  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚    hands     â”‚â”€â”€â”€â–¶â”‚   timeline   â”‚                      â”‚
â”‚  â”‚    Block     â”‚    â”‚    Block     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚                   â”‚                              â”‚
â”‚         â–¼                   â–¼                              â”‚
â”‚  â€¢ í•¸ë“œ ë°ì´í„°         â€¢ íƒ€ì„ë¼ì¸ êµ¬ì¶•                     â”‚
â”‚  â€¢ ë“±ê¸‰ í•„í„°           â€¢ ì¸ë±ìŠ¤ ìƒì„±                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Block ID | ì±…ì„ | ì…ë ¥ | ì¶œë ¥ |
|----------|------|------|------|
| `content.query` | ì½˜í…ì¸  ì¡°íšŒ ë¡œì§ | `ContentQuery` | `RawContent[]` |
| `content.cache` | ìºì‹œ ê³„ì¸µ ê´€ë¦¬ | `CacheKey` | `CachedData` |
| `content.response` | ì‘ë‹µ ì§ë ¬í™” | `RawData` | `APIResponse` |
| `content.hands` | í•¸ë“œ ë°ì´í„° ì²˜ë¦¬ | `ContentId` | `Hand[]` |
| `content.timeline` | íƒ€ì„ë¼ì¸ êµ¬ì¶• | `Hand[]` | `TimelineIndex` |

#### Stream Domain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STREAM DOMAIN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   resolve    â”‚â”€â”€â”€â–¶â”‚  transcode   â”‚â”€â”€â”€â–¶â”‚   deliver    â”‚  â”‚
â”‚  â”‚    Block     â”‚    â”‚    Block     â”‚    â”‚    Block     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                   â”‚          â”‚
â”‚         â–¼                   â–¼                   â–¼          â”‚
â”‚  â€¢ NAS ê²½ë¡œ í™•ì¸       â€¢ FFmpeg ì‹¤í–‰       â€¢ HLS ì„œë¹™     â”‚
â”‚  â€¢ ê¶Œí•œ ê²€ì¦           â€¢ ë¶„ì‚° ë½            â€¢ ì„¸ê·¸ë¨¼íŠ¸ ìºì‹œâ”‚
â”‚  â€¢ íŒŒì¼ ì¡´ì¬ í™•ì¸      â€¢ ì§„í–‰ë¥  ì¶”ì         â€¢ ABR ì²˜ë¦¬    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚   monitor    â”‚                                           â”‚
â”‚  â”‚    Block     â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â€¢ ìƒíƒœ ëª¨ë‹ˆí„°ë§                                            â”‚
â”‚  â€¢ ì—ëŸ¬ ê°ì§€                                                â”‚
â”‚  â€¢ ì¬ì‹œë„ íŠ¸ë¦¬ê±°                                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Block ID | ì±…ì„ | ì…ë ¥ | ì¶œë ¥ |
|----------|------|------|------|
| `stream.resolve` | ìŠ¤íŠ¸ë¦¼ ì†ŒìŠ¤ í™•ì¸ | `StreamRequest` | `ResolvedSource` |
| `stream.transcode` | íŠ¸ëœìŠ¤ì½”ë”© ê´€ë¦¬ | `ResolvedSource` | `HLSManifest` |
| `stream.deliver` | HLS ì „ì†¡ | `HLSManifest` | `StreamResponse` |
| `stream.monitor` | ìƒíƒœ ê°ì‹œ | `StreamId` | `StreamStatus` |

#### Search Domain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEARCH DOMAIN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    parse     â”‚â”€â”€â”€â–¶â”‚    search    â”‚â”€â”€â”€â–¶â”‚    rank      â”‚  â”‚
â”‚  â”‚    Block     â”‚    â”‚    Block     â”‚    â”‚    Block     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                   â”‚          â”‚
â”‚         â–¼                   â–¼                   â–¼          â”‚
â”‚  â€¢ ì¿¼ë¦¬ íŒŒì‹±           â€¢ MeiliSearch       â€¢ ê²°ê³¼ ì •ë ¬    â”‚
â”‚  â€¢ í•„í„° ì¶”ì¶œ           â€¢ íŒ¨ì‹¯ ì§‘ê³„         â€¢ ê°œì¸í™”       â”‚
â”‚  â€¢ ìë™ì™„ì„± ë¶„ê¸°       â€¢ í•˜ì´ë¼ì´íŠ¸        â€¢ ë¶€ìŠ¤íŒ…       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Block ID | ì±…ì„ | ì…ë ¥ | ì¶œë ¥ |
|----------|------|------|------|
| `search.parse` | ê²€ìƒ‰ì–´ ë¶„ì„ | `SearchQuery` | `ParsedQuery` |
| `search.search` | MeiliSearch ì‹¤í–‰ | `ParsedQuery` | `RawResults` |
| `search.rank` | ê²°ê³¼ ë­í‚¹/ì •ë ¬ | `RawResults` | `RankedResults` |

### 2.3 ë¸”ëŸ­ ì˜ì¡´ì„± ê·¸ë˜í”„

```mermaid
graph TD
    subgraph Auth
        AV[auth.validate] --> AT[auth.token]
        AT --> AS[auth.session]
    end

    subgraph Content
        CQ[content.query] --> CC[content.cache]
        CC --> CR[content.response]
        CQ --> CH[content.hands]
        CH --> CTL[content.timeline]
    end

    subgraph Stream
        SR[stream.resolve] --> ST[stream.transcode]
        ST --> SD[stream.deliver]
        SM[stream.monitor] -.-> ST
        SM -.-> SD
    end

    subgraph Search
        SP[search.parse] --> SS[search.search]
        SS --> SRK[search.rank]
    end

    %% Cross-domain dependencies
    AS -.->|ì¸ì¦ í•„ìš”| CQ
    AS -.->|ì¸ì¦ í•„ìš”| SR
    AS -.->|ì¸ì¦ í•„ìš”| SP
    CQ -->|ì½˜í…ì¸  ì •ë³´| SR
    CTL -->|íƒ€ì„ë¼ì¸| SD
```

### 2.4 Vertical Slicing íŒ¨í„´

ê¸°ì¡´ ê³„ì¸µí˜• êµ¬ì¡°ì—ì„œ ê¸°ëŠ¥í˜• êµ¬ì¡°ë¡œ ì „í™˜í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

#### 2.4.1 ê¸°ì¡´ ê³„ì¸µí˜• (Horizontal Layers)

```
apps/web/
â”œâ”€â”€ components/          # ëª¨ë“  ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ VideoPlayer.svelte
â”‚   â”œâ”€â”€ SearchBar.svelte
â”‚   â”œâ”€â”€ AuthForm.svelte
â”‚   â””â”€â”€ ...
â”œâ”€â”€ hooks/               # ëª¨ë“  í›…
â”‚   â”œâ”€â”€ usePlayer.ts
â”‚   â”œâ”€â”€ useSearch.ts
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ stores/              # ëª¨ë“  ìŠ¤í† ì–´
â”‚   â”œâ”€â”€ playerStore.ts
â”‚   â”œâ”€â”€ searchStore.ts
â”‚   â”œâ”€â”€ authStore.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ pages/               # ëª¨ë“  í˜ì´ì§€
```

**ë¬¸ì œì **: AIê°€ "ì¸ì¦ ê¸°ëŠ¥"ì„ ìˆ˜ì •í•˜ë ¤ë©´ 4ê°œ í´ë”ë¥¼ ë’¤ì ¸ì•¼ í•¨ â†’ ì˜¤ë¥˜ ê¸‰ì¦

#### 2.4.2 ê¸°ëŠ¥í˜• (Vertical Slices)

```
apps/web/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/                    # ì¸ì¦ ë¸”ëŸ­ (Self-Contained)
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.svelte
â”‚   â”‚   â”‚   â””â”€â”€ RegisterForm.svelte
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ authStore.ts
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ authApi.ts
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”œâ”€â”€ index.ts             # Public API
â”‚   â”‚   â””â”€â”€ AGENT_RULES.md       # ì—ì´ì „íŠ¸ ê·œì¹™
â”‚   â”‚
â”‚   â”œâ”€â”€ player/                  # í”Œë ˆì´ì–´ ë¸”ëŸ­
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ search/                  # ê²€ìƒ‰ ë¸”ëŸ­
â”‚   â””â”€â”€ content/                 # ì½˜í…ì¸  ë¸”ëŸ­
â”‚
â””â”€â”€ shared/                      # ê³µìœ  ìœ í‹¸ë¦¬í‹° (ìµœì†Œí™”)
    â”œâ”€â”€ ui/                      # ìˆœìˆ˜ UI ì»´í¬ë„ŒíŠ¸
    â””â”€â”€ utils/                   # ìˆœìˆ˜ ìœ í‹¸ë¦¬í‹°
```

**íš¨ê³¼**: AIê°€ "ì¸ì¦ ê¸°ëŠ¥"ì„ ìˆ˜ì •í•  ë•Œ `features/auth/` í´ë”ë§Œ ë³´ë©´ **ì™„ë²½íˆ ì´í•´** ê°€ëŠ¥

#### 2.4.3 ì „í™˜ ê°€ì´ë“œ

| ë‹¨ê³„ | ì‘ì—… |
|------|------|
| 1 | ë„ë©”ì¸ ê²½ê³„ ì‹ë³„ (Auth, Player, Search, Content) |
| 2 | ê° ë„ë©”ì¸ë³„ `features/` í´ë” ìƒì„± |
| 3 | ê´€ë ¨ íŒŒì¼ ì´ë™ (ì»´í¬ë„ŒíŠ¸, í›…, ìŠ¤í† ì–´, íƒ€ì…) |
| 4 | `index.ts`ë¡œ Public API ì •ì˜ |
| 5 | ì™¸ë¶€ ì˜ì¡´ì„±ì€ `shared/`ë¡œ ë¶„ë¦¬ |

### 2.5 ë¸”ëŸ­ ì‚¬ì´ì¦ˆ ê°€ì´ë“œ

"ì–¼ë§ˆë‚˜ ì‘ê²Œ ìª¼ê°œì•¼ í•˜ëŠ”ê°€?"ì— ëŒ€í•œ ì •ëŸ‰ì /ì •ì„±ì  ê¸°ì¤€ì…ë‹ˆë‹¤.

#### 2.5.1 ì‚¬ì´ì¦ˆ ê¸°ì¤€í‘œ

| êµ¬ë¶„ | íŒë‹¨ ê¸°ì¤€ (Threshold) | ìœ„í—˜ ì‹ í˜¸ (Red Flag) |
|------|----------------------|---------------------|
| **ë¬¼ë¦¬ì  í¬ê¸°** | íŒŒì¼ 15~30ê°œ / 30k~50k í† í° | AI "Thinking" ì‹œê°„ 10ì´ˆ+ |
| **ë…¼ë¦¬ì  ë²”ìœ„** | ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP) | ì„¤ëª…ì´ ë‘ ë¬¸ì¥ ì´ìƒ í•„ìš” |
| **ë…ë¦½ì„±** | Self-Contained (ìì²´ ì™„ê²°ì„±) | ìˆ˜ì • ì‹œ ë‹¤ë¥¸ í´ë” íŒŒì¼ ì—´ì–´ì•¼ í•¨ |
| **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±** | ë¸”ëŸ­ ë‹¨ë… í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ | Mockì´ 5ê°œ ì´ìƒ í•„ìš” |

#### 2.5.2 ë¸”ëŸ­ ë¶„í•  ì˜ì‚¬ê²°ì • íŠ¸ë¦¬

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  í˜„ì¬ ë¸”ëŸ­ í¬ê¸°  â”‚
                        â”‚  í‰ê°€ ì‹œì‘       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   íŒŒì¼ 30ê°œ ì´ˆê³¼?        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           YES   â”‚   NO
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
            â”‚  ë¶„í•  í•„ìš” ğŸ”´  â”‚                 â”‚
            â”‚  ì„œë¸Œë¸”ëŸ­ ìƒì„± â”‚                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                              â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  AI ì‘ë‹µ ì‹œê°„ 10ì´ˆ+?     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     YES   â”‚   NO
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼                         â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                      â”‚  ë¶„í•  ê³ ë ¤ ğŸŸ¡  â”‚                 â”‚
                      â”‚  ëª¨ë‹ˆí„°ë§ í•„ìš” â”‚                 â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                                        â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  ì„¤ëª…ì´ 1ë¬¸ì¥ì¸ê°€?     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               YES   â”‚   NO
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â–¼                         â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚  ì ì • í¬ê¸° ğŸŸ¢  â”‚         â”‚  ë¶„í•  ê³ ë ¤ ğŸŸ¡  â”‚
                                â”‚  ìœ ì§€           â”‚         â”‚  ì±…ì„ ë¶„ë¦¬    â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.5.3 WSOPTV ë¸”ëŸ­ë³„ í˜„í™©

| ë¸”ëŸ­ | ì˜ˆìƒ íŒŒì¼ ìˆ˜ | ì˜ˆìƒ í† í° | ìƒíƒœ |
|------|-------------|----------|------|
| `auth` | 12ê°œ | ~25k | ğŸŸ¢ ì ì • |
| `content` | 28ê°œ | ~45k | ğŸŸ¡ ëª¨ë‹ˆí„°ë§ |
| `stream` | 18ê°œ | ~35k | ğŸŸ¢ ì ì • |
| `search` | 10ê°œ | ~20k | ğŸŸ¢ ì ì • |
| `player` | 22ê°œ | ~40k | ğŸŸ¢ ì ì • |

---

## 3. ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ

### 3.1 ì—ì´ì „íŠ¸ ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT HIERARCHY                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Level 0: Orchestrator                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  OrchestratorAgent                   â”‚    â”‚
â”‚  â”‚  â€¢ ì „ì²´ ì›Œí¬í”Œë¡œìš° ì¡°ì •                              â”‚    â”‚
â”‚  â”‚  â€¢ ë„ë©”ì¸ ì—ì´ì „íŠ¸ ìŠ¤ì¼€ì¤„ë§                          â”‚    â”‚
â”‚  â”‚  â€¢ ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ë§                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                 â”‚
â”‚  Level 1: Domain Agents    â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Auth    â”‚ Content  â”‚  Stream  â”‚  Search  â”‚             â”‚
â”‚  â”‚  Agent   â”‚  Agent   â”‚  Agent   â”‚  Agent   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚          â”‚          â”‚          â”‚                    â”‚
â”‚  Level 2: Block Agents                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”             â”‚
â”‚  â”‚validate â”‚â”‚ query   â”‚â”‚transcodeâ”‚â”‚ parse   â”‚             â”‚
â”‚  â”‚ token   â”‚â”‚ cache   â”‚â”‚ deliver â”‚â”‚ search  â”‚             â”‚
â”‚  â”‚session  â”‚â”‚ hands   â”‚â”‚ monitor â”‚â”‚ rank    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ì—ì´ì „íŠ¸ ì¸í„°í˜ì´ìŠ¤

```typescript
// types/agent.ts

interface Agent {
  id: string;                    // 'orchestrator', 'auth-domain', 'auth.validate'
  level: AgentLevel;
  status: AgentStatus;

  // ê´€ë¦¬ ëŒ€ìƒ
  managedBlocks: string[];       // Block IDs
  childAgents: string[];         // Child Agent IDs

  // ëŠ¥ë ¥
  capabilities: Capability[];

  // ì‹¤í–‰
  execute(task: Task): Promise<TaskResult>;

  // ìƒëª…ì£¼ê¸°
  start(): Promise<void>;
  stop(): Promise<void>;
  healthCheck(): Promise<HealthStatus>;
}

type AgentLevel = 'orchestrator' | 'domain' | 'block';
type AgentStatus = 'idle' | 'busy' | 'error' | 'stopped';

interface Capability {
  name: string;
  description: string;
  inputSchema: string;           // Zod ìŠ¤í‚¤ë§ˆ ì°¸ì¡°
  outputSchema: string;
}

interface Task {
  id: string;
  type: TaskType;
  priority: Priority;
  payload: unknown;
  timeout: number;
  retryPolicy: RetryPolicy;
}

type TaskType =
  | 'query'      // ë°ì´í„° ì¡°íšŒ
  | 'mutation'   // ë°ì´í„° ë³€ê²½
  | 'stream'     // ìŠ¤íŠ¸ë¦¬ë° ì‘ì—…
  | 'batch'      // ë°°ì¹˜ ì²˜ë¦¬
  | 'monitor';   // ìƒíƒœ ê°ì‹œ

type Priority = 'critical' | 'high' | 'normal' | 'low';

interface RetryPolicy {
  maxAttempts: number;
  backoffMs: number;
  backoffMultiplier: number;
}
```

### 3.3 ë„ë©”ì¸ ì—ì´ì „íŠ¸ ìƒì„¸

#### AuthDomainAgent

```typescript
// agents/auth-domain-agent.ts

interface AuthDomainAgent extends Agent {
  id: 'auth-domain';
  level: 'domain';

  managedBlocks: [
    'auth.validate',
    'auth.token',
    'auth.session'
  ];

  capabilities: [
    {
      name: 'login',
      description: 'ì‚¬ìš©ì ë¡œê·¸ì¸ ì²˜ë¦¬',
      inputSchema: 'LoginRequestSchema',
      outputSchema: 'AuthResponseSchema'
    },
    {
      name: 'refresh',
      description: 'í† í° ê°±ì‹ ',
      inputSchema: 'RefreshRequestSchema',
      outputSchema: 'TokenPairSchema'
    },
    {
      name: 'logout',
      description: 'ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬',
      inputSchema: 'LogoutRequestSchema',
      outputSchema: 'VoidSchema'
    },
    {
      name: 'validate',
      description: 'Access Token ê²€ì¦',
      inputSchema: 'TokenSchema',
      outputSchema: 'UserContextSchema'
    }
  ];
}
```

#### ContentDomainAgent

```typescript
// agents/content-domain-agent.ts

interface ContentDomainAgent extends Agent {
  id: 'content-domain';
  level: 'domain';

  managedBlocks: [
    'content.query',
    'content.cache',
    'content.response',
    'content.hands',
    'content.timeline'
  ];

  capabilities: [
    {
      name: 'getContent',
      description: 'ì½˜í…ì¸  ìƒì„¸ ì¡°íšŒ',
      inputSchema: 'ContentIdSchema',
      outputSchema: 'ContentDetailSchema'
    },
    {
      name: 'listContents',
      description: 'ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ',
      inputSchema: 'ContentListQuerySchema',
      outputSchema: 'ContentListSchema'
    },
    {
      name: 'getHands',
      description: 'í•¸ë“œ ëª©ë¡ ì¡°íšŒ',
      inputSchema: 'HandQuerySchema',
      outputSchema: 'HandListSchema'
    },
    {
      name: 'buildTimeline',
      description: 'íƒ€ì„ë¼ì¸ ì¸ë±ìŠ¤ ìƒì„±',
      inputSchema: 'ContentIdSchema',
      outputSchema: 'TimelineIndexSchema'
    }
  ];
}
```

#### StreamDomainAgent

```typescript
// agents/stream-domain-agent.ts

interface StreamDomainAgent extends Agent {
  id: 'stream-domain';
  level: 'domain';

  managedBlocks: [
    'stream.resolve',
    'stream.transcode',
    'stream.deliver',
    'stream.monitor'
  ];

  capabilities: [
    {
      name: 'getStreamUrl',
      description: 'HLS ìŠ¤íŠ¸ë¦¼ URL íšë“',
      inputSchema: 'StreamRequestSchema',
      outputSchema: 'StreamUrlSchema'
    },
    {
      name: 'getStreamStatus',
      description: 'ìŠ¤íŠ¸ë¦¼ ìƒíƒœ ì¡°íšŒ',
      inputSchema: 'StreamIdSchema',
      outputSchema: 'StreamStatusSchema'
    },
    {
      name: 'startTranscode',
      description: 'íŠ¸ëœìŠ¤ì½”ë”© ì‹œì‘',
      inputSchema: 'TranscodeRequestSchema',
      outputSchema: 'TranscodeJobSchema'
    }
  ];
}
```

#### SearchDomainAgent

```typescript
// agents/search-domain-agent.ts

interface SearchDomainAgent extends Agent {
  id: 'search-domain';
  level: 'domain';

  managedBlocks: [
    'search.parse',
    'search.search',
    'search.rank'
  ];

  capabilities: [
    {
      name: 'search',
      description: 'ì „ë¬¸ ê²€ìƒ‰',
      inputSchema: 'SearchQuerySchema',
      outputSchema: 'SearchResultSchema'
    },
    {
      name: 'suggest',
      description: 'ìë™ì™„ì„±',
      inputSchema: 'SuggestQuerySchema',
      outputSchema: 'SuggestionListSchema'
    }
  ];
}
```

### 3.4 ì—ì´ì „íŠ¸-ë¸”ëŸ­ ë§¤í•‘ í…Œì´ë¸”

| Agent ID | Level | Managed Blocks | ì£¼ìš” ì±…ì„ |
|----------|-------|----------------|-----------|
| `orchestrator` | 0 | - | ì „ì—­ ì¡°ì •, ì—ëŸ¬ ì²˜ë¦¬ |
| `auth-domain` | 1 | `auth.*` (3ê°œ) | ì¸ì¦/ì¸ê°€ ì „ì²´ |
| `content-domain` | 1 | `content.*` (5ê°œ) | ì½˜í…ì¸  ì¡°íšŒ/ìºì‹œ |
| `stream-domain` | 1 | `stream.*` (4ê°œ) | ìŠ¤íŠ¸ë¦¬ë° ì „ì²´ |
| `search-domain` | 1 | `search.*` (3ê°œ) | ê²€ìƒ‰ ì „ì²´ |
| `auth.validate` | 2 | ë‹¨ì¼ ë¸”ëŸ­ | ì…ë ¥ ê²€ì¦ |
| `auth.token` | 2 | ë‹¨ì¼ ë¸”ëŸ­ | JWT ê´€ë¦¬ |
| ... | 2 | ... | ... |

### 3.5 Agent Rules íŒŒì¼

ê° ë¸”ëŸ­ì— **'ì§€ëŠ¥í˜• ê²½ê³„ì„ '**ì„ ê¸‹ëŠ” ê·œì¹™ íŒŒì¼ì…ë‹ˆë‹¤.

#### 3.5.1 íŒŒì¼ êµ¬ì¡°

```
.claude/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ orchestrator.md          # ìµœìƒìœ„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ê·œì¹™
â”‚   â”œâ”€â”€ auth-domain.md           # Auth ë„ë©”ì¸ ì—ì´ì „íŠ¸ ê·œì¹™
â”‚   â”œâ”€â”€ content-domain.md        # Content ë„ë©”ì¸ ì—ì´ì „íŠ¸ ê·œì¹™
â”‚   â”œâ”€â”€ stream-domain.md         # Stream ë„ë©”ì¸ ì—ì´ì „íŠ¸ ê·œì¹™
â”‚   â””â”€â”€ search-domain.md         # Search ë„ë©”ì¸ ì—ì´ì „íŠ¸ ê·œì¹™
â”‚
apps/web/features/
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ AGENT_RULES.md           # Auth ë¸”ëŸ­ ì „ìš© ê·œì¹™
â”œâ”€â”€ player/
â”‚   â””â”€â”€ AGENT_RULES.md           # Player ë¸”ëŸ­ ì „ìš© ê·œì¹™
â””â”€â”€ ...
```

#### 3.5.2 Agent Rules í…œí”Œë¦¿

```markdown
<!-- features/auth/AGENT_RULES.md -->

# Auth Block Agent Rules

## Identity
- **Role**: ì¸ì¦/ì¸ê°€ ì „ë¬¸ê°€
- **Domain**: Auth
- **Scope**: `features/auth/` ë‚´ë¶€ë§Œ

## Constraints (ì œì•½ ì‚¬í•­)

### DO (í•´ì•¼ í•  ê²ƒ)
- âœ… ì´ í´ë” ë‚´ íŒŒì¼ë§Œ ìˆ˜ì •
- âœ… `types.ts`ì˜ íƒ€ì… ì •ì˜ ìš°ì„  í™•ì¸
- âœ… `index.ts`ë¥¼ í†µí•´ ì™¸ë¶€ ë…¸ì¶œ API ê´€ë¦¬
- âœ… Zod ìŠ¤í‚¤ë§ˆë¡œ ì…ë ¥ ê²€ì¦

### DON'T (í•˜ì§€ ë§ ê²ƒ)
- âŒ `features/` ì™¸ë¶€ íŒŒì¼ ì§ì ‘ ìˆ˜ì •
- âŒ `shared/ui` ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ ìˆ˜ì •
- âŒ ì „ì—­ ìƒíƒœ ì§ì ‘ ì ‘ê·¼ (ìŠ¤í† ì–´ í†µí•´ì„œë§Œ)
- âŒ í•˜ë“œì½”ë”©ëœ ë¹„ë°€ê°’ ì‚¬ìš©

## Dependencies (ì˜ì¡´ì„±)

### ë‚´ë¶€ ì˜ì¡´ì„±
- `@wsoptv/types`: ê³µìœ  íƒ€ì…
- `shared/utils`: ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

### ì™¸ë¶€ ì˜ì¡´ì„±
- `bcrypt`: ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
- `jose`: JWT ì²˜ë¦¬

## Testing
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: `__tests__/` í´ë”
- Mock: `authApi` í•¨ìˆ˜ë§Œ Mock í—ˆìš©

## Error Codes
- `AUTH_INVALID_CREDENTIALS`
- `AUTH_TOKEN_EXPIRED`
- `AUTH_PENDING_APPROVAL`
```

#### 3.5.3 Claude Code í†µí•©

```yaml
# .claude/settings.yaml (ì˜ˆì‹œ)

agents:
  rules_discovery:
    enabled: true
    patterns:
      - ".claude/agents/*.md"
      - "**/AGENT_RULES.md"

  context_isolation:
    enabled: true
    strategy: "vertical_slice"
    max_files: 30
    max_tokens: 50000
```

#### 3.5.4 ê·œì¹™ íŒŒì¼ íš¨ê³¼

| í•­ëª© | Before | After |
|------|--------|-------|
| **ì»¨í…ìŠ¤íŠ¸ ë²”ìœ„** | ì „ì²´ í”„ë¡œì íŠ¸ | í•´ë‹¹ ë¸”ëŸ­ë§Œ |
| **ì—ëŸ¬ìœ¨** | ë†’ìŒ (ë¬´ê´€ ì½”ë“œ ê°„ì„­) | ë‚®ìŒ (ê²©ë¦¬) |
| **ì‘ë‹µ ì†ë„** | ëŠë¦¼ | ë¹ ë¦„ |
| **ì¼ê´€ì„±** | ë‚®ìŒ (ìŠ¤íƒ€ì¼ í˜¼ì¬) | ë†’ìŒ (ê·œì¹™ ì ìš©) |

---

## 4. ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íŒ¨í„´

### 4.1 ì±„íƒ íŒ¨í„´

WSOPTVëŠ” **Hybrid Orchestration** íŒ¨í„´ì„ ì±„íƒí•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  HYBRID ORCHESTRATION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Orchestrator (Hierarchical)             â”‚    â”‚
â”‚  â”‚  â€¢ ê¸€ë¡œë²Œ ìƒíƒœ ê´€ë¦¬                                  â”‚    â”‚
â”‚  â”‚  â€¢ ë„ë©”ì¸ ê°„ ì¡°ì •                                    â”‚    â”‚
â”‚  â”‚  â€¢ ë³µêµ¬ ì „ëµ ê²°ì •                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Domain Layer (Pipeline within)             â”‚      â”‚
â”‚  â”‚                                                     â”‚      â”‚
â”‚  â”‚    Auth          Content         Stream            â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”         â”‚      â”‚
â”‚  â”‚  â”‚V â”‚T â”‚S â”‚â”€â”€â”€â–¶â”‚Q â”‚C â”‚R â”‚â”€â”€â”€â–¶â”‚R â”‚T â”‚D â”‚         â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”´â”€â”€â”´â”€â”€â”˜    â””â”€â”€â”´â”€â”€â”´â”€â”€â”˜    â””â”€â”€â”´â”€â”€â”´â”€â”€â”˜         â”‚      â”‚
â”‚  â”‚   Pipeline      Pipeline       Pipeline           â”‚      â”‚
â”‚  â”‚                                                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

V=Validate, T=Token, S=Session
Q=Query, C=Cache, R=Response
R=Resolve, T=Transcode, D=Deliver
```

### 4.2 ì›Œí¬í”Œë¡œìš° ì˜ˆì‹œ: ë¹„ë””ì˜¤ ì¬ìƒ

```mermaid
sequenceDiagram
    autonumber
    participant Client
    participant Orch as Orchestrator
    participant Auth as AuthDomain
    participant Content as ContentDomain
    participant Stream as StreamDomain

    Client->>Orch: playVideo(contentId)

    %% Phase 1: ì¸ì¦
    Orch->>Auth: validateAccess(token)
    Auth->>Auth: validate â†’ token â†’ session
    Auth-->>Orch: UserContext

    %% Phase 2: ì½˜í…ì¸  ì¡°íšŒ
    Orch->>Content: getContent(contentId)
    Content->>Content: query â†’ cache â†’ response
    Content-->>Orch: ContentDetail + Hands

    %% Phase 3: ìŠ¤íŠ¸ë¦¼ ì¤€ë¹„
    Orch->>Stream: getStreamUrl(fileId)
    Stream->>Stream: resolve â†’ transcode â†’ deliver
    Stream-->>Orch: StreamUrl

    %% ì‘ë‹µ
    Orch-->>Client: PlayResponse { content, hands, streamUrl }
```

### 4.3 ë³‘ë ¬ ì²˜ë¦¬ íŒ¨í„´

ë…ë¦½ì ì¸ ë¸”ëŸ­ì€ ë³‘ë ¬ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤:

```typescript
// orchestrator/video-play-workflow.ts

async function executeVideoPlayWorkflow(
  contentId: number,
  userContext: UserContext
): Promise<PlayResponse> {

  // ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ì‘ì—…ë“¤
  const [content, hands] = await Promise.all([
    contentAgent.execute({ type: 'getContent', payload: { contentId } }),
    contentAgent.execute({ type: 'getHands', payload: { contentId } })
  ]);

  // ì˜ì¡´ì„± ìˆëŠ” ìˆœì°¨ ì‹¤í–‰
  const streamUrl = await streamAgent.execute({
    type: 'getStreamUrl',
    payload: { fileId: content.fileId, userId: userContext.userId }
  });

  // ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (ì‘ë‹µì— í¬í•¨ë˜ì§€ ì•ŠìŒ)
  void streamAgent.execute({
    type: 'monitor',
    payload: { streamId: streamUrl.streamId }
  });

  return { content, hands, streamUrl };
}
```

### 4.4 Conductor ì›Œí¬í”Œë¡œìš°

ê°œë°œìëŠ” ì½”ë”(Coder)ê°€ ì•„ë‹Œ **ì§€íœ˜ì(Conductor)**ê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

#### 4.4.1 ì—­í•  ì „í™˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROLE TRANSFORMATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚    Before (ì½”ë”)                 After (ì§€íœ˜ì)              â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚                                                              â”‚
â”‚    ê°œë°œì â†’ ì½”ë“œ ì‘ì„±           ê°œë°œì â†’ ì§€ì‹œ ì „ë‹¬          â”‚
â”‚         â†“                            â†“                      â”‚
â”‚    AI â† ì½”ë“œ ë°›ì•„ì ê¸°           Orchestrator Agent          â”‚
â”‚                                      â†“                      â”‚
â”‚                                 Domain Agents               â”‚
â”‚                                      â†“                      â”‚
â”‚                                 Block Agents â†’ ì½”ë“œ ì‘ì„±    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4.2 3ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°

```mermaid
sequenceDiagram
    autonumber
    actor Dev as Developer (ì§€íœ˜ì)
    participant Orch as Orchestrator
    participant Domain as Domain Agent
    participant Block as Block Agent

    Note over Dev,Block: Phase 1: ì§€íœ˜ (Orchestration)
    Dev->>Orch: "ê²°ì œ ë¸”ëŸ­ì— PGì‚¬ ì—°ë™ ë¡œì§ ì—…ë°ì´íŠ¸í•´ì¤˜"
    Orch->>Orch: ì‘ì—… ë¶„í•´ ë° ë¼ìš°íŒ… ê²°ì •
    Orch->>Domain: delegateTask(payment-domain, pgIntegration)

    Note over Dev,Block: Phase 2: ì‹¤í–‰ (Execution)
    Domain->>Block: execute(payment.gateway)
    Block->>Block: features/payment/ ë‚´ì—ì„œë§Œ ì‘ì—…
    Block->>Block: AGENT_RULES.md ê·œì¹™ ì¤€ìˆ˜
    Block-->>Domain: ê²°ê³¼ + ë³€ê²½ íŒŒì¼ ëª©ë¡

    Note over Dev,Block: Phase 3: ê²€ì¦ (Integration)
    Domain-->>Orch: ì‘ì—… ì™„ë£Œ ë³´ê³ 
    Orch->>Orch: ì „ì²´ ë¹Œë“œ/í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    Orch-->>Dev: ê²°ê³¼ ë³´ê³  + PR ìƒì„± ì œì•ˆ

    alt ê²€ì¦ ì„±ê³µ
        Dev->>Orch: "PR ìƒì„±í•´ì¤˜"
        Orch->>Orch: PR ìƒì„±
    else ê²€ì¦ ì‹¤íŒ¨
        Dev->>Orch: "ì—ëŸ¬ ìˆ˜ì •í•´ì¤˜"
        Orch->>Domain: ì¬ì‘ì—… ìš”ì²­
    end
```

#### 4.4.3 ì§€íœ˜ ëª…ë ¹ ì˜ˆì‹œ

| ì§€íœ˜ ëª…ë ¹ | ë¼ìš°íŒ… | ì‹¤í–‰ ë¸”ëŸ­ |
|----------|--------|----------|
| "ì¸ì¦ ë¡œì§ì— 2FA ì¶”ê°€í•´ì¤˜" | auth-domain | auth.token, auth.session |
| "ê²€ìƒ‰ ê²°ê³¼ ì •ë ¬ ë°©ì‹ ë³€ê²½í•´ì¤˜" | search-domain | search.rank |
| "ìŠ¤íŠ¸ë¦¬ë° í’ˆì§ˆ ì˜µì…˜ ì¶”ê°€í•´ì¤˜" | stream-domain | stream.transcode, stream.deliver |
| "í”Œë ˆì´ì–´ì— í•¸ë“œ ìŠ¤í‚µ ê¸°ëŠ¥ ì¶”ê°€í•´ì¤˜" | content-domain + player | content.timeline, player |

#### 4.4.4 ì§€íœ˜ì ëª¨ë²” ì‚¬ë¡€

```markdown
## Good (ì¢‹ì€ ì§€íœ˜)

âœ… "Auth ë„ë©”ì¸ì—ì„œ ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œ ì‹œê°„ì„ í™˜ê²½ë³„ë¡œ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì¤˜"
   â†’ ëª…í™•í•œ ë„ë©”ì¸ + êµ¬ì²´ì ì¸ ìš”êµ¬ì‚¬í•­

âœ… "Content ë¸”ëŸ­ì˜ í•¸ë“œ ìºì‹œ TTLì„ 5ë¶„ì—ì„œ 10ë¶„ìœ¼ë¡œ ë³€ê²½í•´ì¤˜"
   â†’ ì •í™•í•œ ë¸”ëŸ­ + ìˆ˜ì¹˜ ëª…ì‹œ

âœ… "Stream ë„ë©”ì¸ì—ì„œ íŠ¸ëœìŠ¤ì½”ë”© ì§„í–‰ë¥ ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•˜ëŠ” ê¸°ëŠ¥ ì¶”ê°€í•´ì¤˜"
   â†’ ë„ë©”ì¸ ë²”ìœ„ + ê¸°ëŠ¥ ì„¤ëª…

## Bad (ë‚˜ìœ ì§€íœ˜)

âŒ "ì „ì²´ì ìœ¼ë¡œ ì„±ëŠ¥ ê°œì„ í•´ì¤˜"
   â†’ ë²”ìœ„ ë¶ˆëª…í™•, ì¸¡ì • ê¸°ì¤€ ì—†ìŒ

âŒ "ë²„ê·¸ ê³ ì³ì¤˜"
   â†’ ì–´ë–¤ ë²„ê·¸ì¸ì§€ ë¶ˆëª…í™•

âŒ "ì½”ë“œ ì •ë¦¬ ì¢€ í•´ì¤˜"
   â†’ ë²”ìœ„ì™€ ê¸°ì¤€ ì—†ìŒ
```

---

## 5. í†µì‹  í”„ë¡œí† ì½œ

### 5.1 ë©”ì‹œì§€ í¬ë§·

```typescript
// types/message.ts

interface AgentMessage {
  id: string;                    // UUID v7 (ì‹œê°„ ì •ë ¬ ê°€ëŠ¥)
  timestamp: number;             // Unix ms
  source: string;                // Agent ID
  target: string;                // Agent ID | 'broadcast'
  type: MessageType;
  payload: unknown;

  // ì¶”ì 
  correlationId: string;         // ìš”ì²­-ì‘ë‹µ ì—°ê²°
  traceId: string;               // ë¶„ì‚° ì¶”ì 
  spanId: string;

  // ë©”íƒ€ë°ì´í„°
  priority: Priority;
  ttl: number;                   // Time to live (ms)
}

type MessageType =
  | 'task.request'
  | 'task.response'
  | 'task.error'
  | 'status.update'
  | 'health.ping'
  | 'health.pong';
```

### 5.2 ì´ë²¤íŠ¸ ë²„ìŠ¤

```typescript
// infrastructure/event-bus.ts

interface EventBus {
  // ë°œí–‰
  publish(event: AgentEvent): Promise<void>;

  // êµ¬ë…
  subscribe(
    pattern: string,             // 'auth.*', 'stream.transcode.completed'
    handler: EventHandler
  ): Subscription;

  // ìš”ì²­-ì‘ë‹µ
  request(
    target: string,
    message: AgentMessage,
    timeout: number
  ): Promise<AgentMessage>;
}

interface AgentEvent {
  type: string;                  // 'block.started', 'block.completed', 'block.error'
  source: string;
  payload: unknown;
  timestamp: number;
}

// ì´ë²¤íŠ¸ íƒ€ì… ì˜ˆì‹œ
type BlockEvent =
  | { type: 'block.started'; blockId: string; taskId: string }
  | { type: 'block.completed'; blockId: string; taskId: string; result: unknown }
  | { type: 'block.error'; blockId: string; taskId: string; error: ErrorInfo };
```

### 5.3 ë¸”ëŸ­ ê°„ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA FLOW EXAMPLE                         â”‚
â”‚                    (Content Query Flow)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Request: GET /contents/123                                  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ content.query â”‚                                          â”‚
â”‚  â”‚    Block      â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚         â”‚ RawContent                                        â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ content.cacheâ”‚ â”€â”€â”€â–¶â”‚content.hands â”‚                     â”‚
â”‚  â”‚    Block     â”‚     â”‚    Block     â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚ CachedContent       â”‚ Hand[]                      â”‚
â”‚         â”‚                     â”‚                             â”‚
â”‚         â–¼                     â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚        content.response Block       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                 â”‚                                           â”‚
â”‚                 â–¼                                           â”‚
â”‚  Response: ContentDetailResponse                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬

### 6.1 ì—ëŸ¬ ë¶„ë¥˜

```typescript
// types/error.ts

interface BlockError {
  code: ErrorCode;
  severity: ErrorSeverity;
  blockId: string;
  message: string;
  cause?: unknown;

  // ë³µêµ¬ íŒíŠ¸
  recoverable: boolean;
  retryAfter?: number;           // ms
  fallbackStrategy?: FallbackStrategy;
}

type ErrorSeverity = 'critical' | 'error' | 'warning';

type ErrorCode =
  // Block Errors
  | 'BLOCK_TIMEOUT'
  | 'BLOCK_UNAVAILABLE'
  | 'BLOCK_VALIDATION_FAILED'

  // Agent Errors
  | 'AGENT_OVERLOADED'
  | 'AGENT_COMMUNICATION_FAILED'

  // Domain Errors
  | 'AUTH_FAILED'
  | 'CONTENT_NOT_FOUND'
  | 'STREAM_SOURCE_ERROR'
  | 'SEARCH_INDEX_ERROR';

type FallbackStrategy =
  | 'retry'                      // ì¬ì‹œë„
  | 'fallback_cache'             // ìºì‹œëœ ê°’ ì‚¬ìš©
  | 'fallback_default'           // ê¸°ë³¸ê°’ ë°˜í™˜
  | 'circuit_break'              // íšŒë¡œ ì°¨ë‹¨
  | 'escalate';                  // ìƒìœ„ ì—ì´ì „íŠ¸ë¡œ ìœ„ì„
```

### 6.2 Circuit Breaker íŒ¨í„´

```typescript
// infrastructure/circuit-breaker.ts

interface CircuitBreakerConfig {
  failureThreshold: number;      // ì‹¤íŒ¨ ì„ê³„ê°’ (ê¸°ë³¸: 5)
  successThreshold: number;      // ë³µêµ¬ ì„ê³„ê°’ (ê¸°ë³¸: 3)
  timeout: number;               // ë°˜ì—´ë¦¼ ëŒ€ê¸° (ê¸°ë³¸: 30000ms)
}

type CircuitState = 'closed' | 'open' | 'half-open';

class BlockCircuitBreaker {
  private state: CircuitState = 'closed';
  private failures: number = 0;
  private successes: number = 0;
  private lastFailure: number = 0;

  async execute<T>(block: Block, task: Task): Promise<T> {
    if (this.state === 'open') {
      if (Date.now() - this.lastFailure > this.config.timeout) {
        this.state = 'half-open';
      } else {
        throw new CircuitOpenError(block.id);
      }
    }

    try {
      const result = await block.execute(task);
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }

  private onSuccess() {
    if (this.state === 'half-open') {
      this.successes++;
      if (this.successes >= this.config.successThreshold) {
        this.state = 'closed';
        this.failures = 0;
        this.successes = 0;
      }
    }
  }

  private onFailure() {
    this.failures++;
    this.lastFailure = Date.now();

    if (this.failures >= this.config.failureThreshold) {
      this.state = 'open';
      this.successes = 0;
    }
  }
}
```

### 6.3 ë³µêµ¬ ì „ëµ ë§¤íŠ¸ë¦­ìŠ¤

| ì—ëŸ¬ ì½”ë“œ | Severity | ë³µêµ¬ ê°€ëŠ¥ | ì „ëµ |
|-----------|----------|----------|------|
| `BLOCK_TIMEOUT` | error | âœ… | retry (3íšŒ, ì§€ìˆ˜ ë°±ì˜¤í”„) |
| `BLOCK_UNAVAILABLE` | critical | âŒ | circuit_break â†’ escalate |
| `BLOCK_VALIDATION_FAILED` | warning | âŒ | ì¦‰ì‹œ ë°˜í™˜ (400) |
| `AUTH_FAILED` | error | âŒ | ì¦‰ì‹œ ë°˜í™˜ (401) |
| `CONTENT_NOT_FOUND` | warning | âŒ | fallback_default (404) |
| `STREAM_SOURCE_ERROR` | error | âœ… | retry â†’ fallback_cache |
| `SEARCH_INDEX_ERROR` | error | âœ… | fallback_cache |

---

## 7. êµ¬í˜„ ê°€ì´ë“œ

### 7.1 ìƒˆ ë¸”ëŸ­ ì¶”ê°€ ì²´í¬ë¦¬ìŠ¤íŠ¸

```markdown
## New Block Checklist

### 1. ì •ì˜
- [ ] Block ID ê²°ì • (format: `{domain}.{name}`)
- [ ] ë„ë©”ì¸ ì—ì´ì „íŠ¸ í™•ì¸
- [ ] ì…ë ¥/ì¶œë ¥ í¬íŠ¸ ì •ì˜
- [ ] Zod ìŠ¤í‚¤ë§ˆ ì‘ì„±

### 2. êµ¬í˜„
- [ ] Block í´ë˜ìŠ¤ ìƒì„±
- [ ] ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ì¶”ê°€
- [ ] Circuit Breaker ì ìš©

### 3. í†µí•©
- [ ] ë„ë©”ì¸ ì—ì´ì „íŠ¸ì— ë“±ë¡
- [ ] ì˜ì¡´ì„± ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
- [ ] ì´ë²¤íŠ¸ ë°œí–‰ ì„¤ì •

### 4. í…ŒìŠ¤íŠ¸
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ë¸”ëŸ­ ë‹¨ë…)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ (íŒŒì´í”„ë¼ì¸)
- [ ] ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

### 5. ë¬¸ì„œ
- [ ] ë¸”ëŸ­ ë§µ ì—…ë°ì´íŠ¸
- [ ] API ë¬¸ì„œ ê°±ì‹ 
- [ ] ë³€ê²½ ì´ë ¥ ê¸°ë¡
```

### 7.2 ìƒˆ ì—ì´ì „íŠ¸ ì¶”ê°€ ì²´í¬ë¦¬ìŠ¤íŠ¸

```markdown
## New Agent Checklist

### 1. ì„¤ê³„
- [ ] Agent ID ê²°ì •
- [ ] Level ê²°ì • (domain/block)
- [ ] ê´€ë¦¬ ëŒ€ìƒ ë¸”ëŸ­ ì •ì˜
- [ ] Capabilities ì •ì˜

### 2. êµ¬í˜„
- [ ] Agent ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
- [ ] Task ë¼ìš°íŒ… ë¡œì§
- [ ] í•˜ìœ„ ì—ì´ì „íŠ¸ ê´€ë¦¬ (domainì¸ ê²½ìš°)
- [ ] í—¬ìŠ¤ ì²´í¬ êµ¬í˜„

### 3. ë“±ë¡
- [ ] Orchestratorì— ë“±ë¡ (domainì¸ ê²½ìš°)
- [ ] ë¶€ëª¨ ì—ì´ì „íŠ¸ì— ë“±ë¡ (blockì¸ ê²½ìš°)
- [ ] ì´ë²¤íŠ¸ ë²„ìŠ¤ êµ¬ë… ì„¤ì •

### 4. ëª¨ë‹ˆí„°ë§
- [ ] ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì„¤ì •
- [ ] ì•Œë¦¼ ê·œì¹™ ì„¤ì •
- [ ] ëŒ€ì‹œë³´ë“œ ì¶”ê°€
```

### 7.3 íŒŒì¼ êµ¬ì¡°

```
packages/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ block.ts              # Block ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ agent.ts              # Agent ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ message.ts            # ë©”ì‹œì§€ íƒ€ì…
â”‚   â””â”€â”€ error.ts              # ì—ëŸ¬ íƒ€ì…
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ event-bus.ts          # ì´ë²¤íŠ¸ ë²„ìŠ¤
â”‚   â”œâ”€â”€ circuit-breaker.ts    # íšŒë¡œ ì°¨ë‹¨ê¸°
â”‚   â””â”€â”€ metrics.ts            # ë©”íŠ¸ë¦­ ìˆ˜ì§‘
â”‚
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ orchestrator/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ auth-domain/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ blocks/
â”‚   â”‚       â”œâ”€â”€ validate.ts
â”‚   â”‚       â”œâ”€â”€ token.ts
â”‚   â”‚       â””â”€â”€ session.ts
â”‚   â”œâ”€â”€ content-domain/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ blocks/
â”‚   â”‚       â”œâ”€â”€ query.ts
â”‚   â”‚       â”œâ”€â”€ cache.ts
â”‚   â”‚       â”œâ”€â”€ response.ts
â”‚   â”‚       â”œâ”€â”€ hands.ts
â”‚   â”‚       â””â”€â”€ timeline.ts
â”‚   â”œâ”€â”€ stream-domain/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ blocks/
â”‚   â”‚       â”œâ”€â”€ resolve.ts
â”‚   â”‚       â”œâ”€â”€ transcode.ts
â”‚   â”‚       â”œâ”€â”€ deliver.ts
â”‚   â”‚       â””â”€â”€ monitor.ts
â”‚   â””â”€â”€ search-domain/
â”‚       â”œâ”€â”€ index.ts
â”‚       â””â”€â”€ blocks/
â”‚           â”œâ”€â”€ parse.ts
â”‚           â”œâ”€â”€ search.ts
â”‚           â””â”€â”€ rank.ts
```

---

## ë³€ê²½ ì´ë ¥

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-12-09 | ì´ˆê¸° ì•„í‚¤í…ì²˜ ë¬¸ì„œ |
| 2.0.0 | 2025-12-09 | AI ì»¨í…ìŠ¤íŠ¸ ìµœì í™”, Vertical Slicing, ë¸”ëŸ­ ì‚¬ì´ì¦ˆ ê°€ì´ë“œ, Agent Rules, Conductor ì›Œí¬í”Œë¡œìš° ì¶”ê°€ |

---

## ì°¸ì¡°

### ì™¸ë¶€ ë¦¬ì†ŒìŠ¤

- [Azure AI Agent Design Patterns](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/ai-agent-design-patterns)
- [Google Cloud Agentic AI Patterns](https://docs.cloud.google.com/architecture/choose-design-pattern-agentic-ai-system)
- [Confluent Multi-Agent Systems](https://www.confluent.io/blog/event-driven-multi-agent-systems/)
- [OpenAI Swarm](https://github.com/openai/swarm)

### ê´€ë ¨ ë¬¸ì„œ

- [LLD Master](../lld/0001-lld-wsoptv-platform.md)
- [LLD Modules](../lld/0002-lld-modules.md)
- [LLD Flows](../lld/0005-lld-flows.md)
