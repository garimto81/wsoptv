# Code Isolation Agent System (ì½”ë“œ ì˜¤ì—¼ ë°©ì§€ ì „ë‹´ ì—ì´ì „íŠ¸)

**Version**: 1.0.0
**Date**: 2025-12-10
**Author**: Claude Code
**Status**: Draft

---

## 1. Executive Summary

AI ì—ì´ì „íŠ¸ì˜ ì½”ë“œ ìˆ˜ì • ë²”ìœ„ë¥¼ ê°•ì œì ìœ¼ë¡œ ì œí•œí•˜ì—¬ **ì½”ë“œ ì˜¤ì—¼(Code Pollution)**ì„ ë°©ì§€í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### 1.1 ë¬¸ì œ ì •ì˜

| ë¬¸ì œ | ì„¤ëª… | ìœ„í—˜ë„ |
|------|------|--------|
| **ë²”ìœ„ ì´ˆê³¼ ìˆ˜ì •** | ìš”ì²­ëœ ê¸°ëŠ¥ ì™¸ ê´€ë ¨ ì—†ëŠ” íŒŒì¼ ìˆ˜ì • | ğŸ”´ High |
| **ê³¼ë„í•œ ë¦¬íŒ©í† ë§** | ê°„ë‹¨í•œ ë²„ê·¸ ìˆ˜ì • ì‹œ ì „ì²´ íŒŒì¼ ë¦¬íŒ©í† ë§ | ğŸŸ  Medium |
| **ì˜ì¡´ì„± ì—°ì‡„** | A ìˆ˜ì • â†’ B ìˆ˜ì • â†’ C ìˆ˜ì • ... ë¬´í•œ í™•ì‚° | ğŸ”´ High |
| **ìŠ¤íƒ€ì¼ í†µì¼ ê°•ë°•** | ì½”ë“œ ìŠ¤íƒ€ì¼ í†µì¼ì„ ìœ„í•œ ë¶ˆí•„ìš”í•œ ë³€ê²½ | ğŸŸ¡ Low |
| **"ê°œì„ " ì¶©ë™** | ë™ì‘í•˜ëŠ” ì½”ë“œì˜ ë¶ˆí•„ìš”í•œ "ê°œì„ " | ğŸŸ  Medium |

### 1.2 í•´ê²° ëª©í‘œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Code Isolation Principles                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. Minimal Change Principle (ìµœì†Œ ë³€ê²½ ì›ì¹™)                        â”‚
â”‚     "ìš”ì²­ëœ ê²ƒë§Œ, í•„ìš”í•œ ë§Œí¼ë§Œ"                                      â”‚
â”‚                                                                      â”‚
â”‚  2. Scope Enforcement (ë²”ìœ„ ê°•ì œ)                                    â”‚
â”‚     "í—ˆìš©ëœ í´ë” ì™¸ ìˆ˜ì • ì°¨ë‹¨"                                        â”‚
â”‚                                                                      â”‚
â”‚  3. Change Justification (ë³€ê²½ ì •ë‹¹í™”)                               â”‚
â”‚     "ëª¨ë“  ìˆ˜ì •ì—ëŠ” ëª…ì‹œì  ì´ìœ ê°€ í•„ìš”"                                 â”‚
â”‚                                                                      â”‚
â”‚  4. Diff Preview (ë³€ê²½ ë¯¸ë¦¬ë³´ê¸°)                                     â”‚
â”‚     "ìˆ˜ì • ì „ ì˜í–¥ ë²”ìœ„ ë¶„ì„"                                          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Architecture

### 2.1 Agent ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Code Isolation Agent System                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  Orchestrator   â”‚ â† ì‘ì—… ì§€ì‹œ ìˆ˜ì‹                                â”‚
â”‚  â”‚   (ë¼ìš°íŒ…)      â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                          â”‚
â”‚           â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  Scope Guard    â”‚ â† ğŸ›¡ï¸ ë²”ìœ„ ê²€ì¦ ì—ì´ì „íŠ¸ (ì‹ ê·œ)                 â”‚
â”‚  â”‚   (ë²”ìœ„ ê°ì‹œ)   â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                          â”‚
â”‚           â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ Domain Agent    â”‚ â† ë„ë©”ì¸ë³„ ì‘ì—… ìˆ˜í–‰                           â”‚
â”‚  â”‚ (auth, stream)  â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                          â”‚
â”‚           â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ Change Auditor  â”‚ â† ğŸ” ë³€ê²½ ê°ì‚¬ ì—ì´ì „íŠ¸ (ì‹ ê·œ)                 â”‚
â”‚  â”‚  (ë³€ê²½ ê°ì‚¬)    â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ì‹ ê·œ ì—ì´ì „íŠ¸ ì—­í• 

| ì—ì´ì „íŠ¸ | ì—­í•  | ì‹¤í–‰ ì‹œì  |
|----------|------|----------|
| **Scope Guard** | ìˆ˜ì • ê°€ëŠ¥ ë²”ìœ„ ì‚¬ì „ ê²€ì¦ | Domain Agent ì‹¤í–‰ ì „ |
| **Change Auditor** | ì‹¤ì œ ë³€ê²½ ë‚´ì—­ ì‚¬í›„ ê°ì‚¬ | ì»¤ë°‹ ì „ |

---

## 3. Scope Guard Agent (ë²”ìœ„ ê°ì‹œ ì—ì´ì „íŠ¸)

### 3.1 ì—­í• 

```python
class ScopeGuardAgent:
    """
    ì½”ë“œ ìˆ˜ì • ë²”ìœ„ë¥¼ ì‚¬ì „ì— ê²€ì¦í•˜ê³  ê°•ì œí•˜ëŠ” ì—ì´ì „íŠ¸
    """

    def __init__(self, domain: str, task: str):
        self.domain = domain
        self.task = task
        self.allowed_paths = self._load_allowed_paths(domain)

    def _load_allowed_paths(self, domain: str) -> list[str]:
        """ë„ë©”ì¸ë³„ í—ˆìš© ê²½ë¡œ ë¡œë“œ"""
        base_paths = {
            "auth": ["features/auth/", "packages/types/src/auth.ts"],
            "content": ["features/content/", "packages/types/src/content.ts"],
            "stream": ["features/player/", "packages/types/src/player.ts"],
            "search": ["features/search/", "packages/types/src/search.ts"],
            "home": ["features/home/", "packages/types/src/home.ts"],
        }

        # ê³µí†µ í—ˆìš© ê²½ë¡œ
        common = ["e2e/specs/{domain}/", "tests/{domain}/"]

        return base_paths.get(domain, []) + common

    def validate_intent(self, files_to_modify: list[str]) -> ValidationResult:
        """ìˆ˜ì • ì˜ë„ ê²€ì¦"""
        violations = []

        for file in files_to_modify:
            if not self._is_allowed(file):
                violations.append({
                    "file": file,
                    "reason": "Out of scope",
                    "allowed_paths": self.allowed_paths
                })

        if violations:
            return ValidationResult(
                valid=False,
                violations=violations,
                suggestion="ë‹¤ìŒ íŒŒì¼ì€ ìˆ˜ì • ë²”ìœ„ë¥¼ ë²—ì–´ë‚©ë‹ˆë‹¤. ì •ë§ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ëª…ì‹œì  ìŠ¹ì¸ì„ ìš”ì²­í•˜ì„¸ìš”."
            )

        return ValidationResult(valid=True)
```

### 3.2 Scope Definition (ë²”ìœ„ ì •ì˜)

```yaml
# .claude/scopes/domain-scopes.yaml

domains:
  auth:
    primary:
      - "apps/web/features/auth/**"
      - "backend/src/api/v1/auth.py"
      - "backend/src/services/auth.py"
    secondary:  # ëª…ì‹œì  ìŠ¹ì¸ í•„ìš”
      - "packages/types/src/auth.ts"
      - "backend/src/core/security.py"
    forbidden:  # ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€
      - "backend/src/core/config.py"
      - "apps/web/lib/stores/index.ts"

  home:
    primary:
      - "apps/web/features/home/**"
      - "backend/src/api/v1/home.py"
      - "backend/src/services/row_service.py"
    secondary:
      - "packages/types/src/home.ts"
      - "backend/src/api/v1/jellyfin.py"
    forbidden:
      - "apps/web/features/auth/**"
      - "apps/web/features/player/**"

  content:
    primary:
      - "apps/web/features/content/**"
      - "backend/src/api/v1/contents.py"
    secondary:
      - "packages/types/src/content.ts"
    forbidden:
      - "apps/web/features/auth/**"

  stream:
    primary:
      - "apps/web/features/player/**"
      - "backend/src/api/v1/stream.py"
      - "backend/src/services/streaming.py"
    secondary:
      - "packages/types/src/player.ts"
    forbidden:
      - "apps/web/features/auth/**"
```

### 3.3 Scope Guard ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Scope Guard Execution Flow                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  1. Task ë¶„ì„                                                         â”‚
â”‚     â”‚                                                                 â”‚
â”‚     â””â”€â–¶ ìˆ˜ì • ì˜ˆìƒ íŒŒì¼ ëª©ë¡ ì¶”ì¶œ                                      â”‚
â”‚                                                                       â”‚
â”‚  2. Scope ê²€ì¦                                                        â”‚
â”‚     â”‚                                                                 â”‚
â”‚     â”œâ”€â–¶ Primary ë²”ìœ„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ âœ… ìë™ í—ˆìš©            â”‚
â”‚     â”‚                                                                 â”‚
â”‚     â”œâ”€â–¶ Secondary ë²”ìœ„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ âš ï¸ ì‚¬ìš©ì ìŠ¹ì¸ í•„ìš”    â”‚
â”‚     â”‚     "packages/types/src/auth.tsë¥¼ ìˆ˜ì •í•˜ë ¤ê³  í•©ë‹ˆë‹¤.            â”‚
â”‚     â”‚      ì´ íŒŒì¼ì€ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œë„ ì‚¬ìš©ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"    â”‚
â”‚     â”‚                                                                 â”‚
â”‚     â””â”€â–¶ Forbidden ë²”ìœ„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ âŒ ì°¨ë‹¨ + ê²½ê³           â”‚
â”‚           "config.pyëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.                            â”‚
â”‚            ì´ íŒŒì¼ì„ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²½ìš° ë³„ë„ ì´ìŠˆë¥¼ ìƒì„±í•˜ì„¸ìš”."       â”‚
â”‚                                                                       â”‚
â”‚  3. ìŠ¹ì¸ëœ ë²”ìœ„ë§Œ Domain Agentì— ì „ë‹¬                                  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Change Auditor Agent (ë³€ê²½ ê°ì‚¬ ì—ì´ì „íŠ¸)

### 4.1 ì—­í• 

```python
class ChangeAuditorAgent:
    """
    ì‹¤ì œ ë³€ê²½ ë‚´ì—­ì„ ë¶„ì„í•˜ê³  ë¶ˆí•„ìš”í•œ ë³€ê²½ì„ ê°ì§€í•˜ëŠ” ì—ì´ì „íŠ¸
    """

    def audit_changes(self, diff: str, task: str) -> AuditResult:
        """ë³€ê²½ ë‚´ì—­ ê°ì‚¬"""

        changes = self._parse_diff(diff)
        issues = []

        for change in changes:
            # 1. ë²”ìœ„ ì™¸ ìˆ˜ì • ê°ì§€
            if not self._is_task_related(change, task):
                issues.append({
                    "type": "SCOPE_VIOLATION",
                    "file": change.file,
                    "reason": "ì´ ë³€ê²½ì€ ìš”ì²­ëœ ì‘ì—…ê³¼ ê´€ë ¨ì´ ì—†ìŠµë‹ˆë‹¤."
                })

            # 2. ê³¼ë„í•œ ë¦¬íŒ©í† ë§ ê°ì§€
            if self._is_over_refactoring(change):
                issues.append({
                    "type": "OVER_REFACTORING",
                    "file": change.file,
                    "reason": "ë¶ˆí•„ìš”í•œ ì½”ë“œ ìŠ¤íƒ€ì¼ ë³€ê²½ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.",
                    "lines": change.style_only_changes
                })

            # 3. ì˜ì¡´ì„± ì—°ì‡„ ê°ì§€
            if self._triggers_cascade(change):
                issues.append({
                    "type": "CASCADE_RISK",
                    "file": change.file,
                    "reason": "ì´ ë³€ê²½ì€ ë‹¤ë¥¸ íŒŒì¼ì˜ ìˆ˜ì •ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "affected": change.dependents
                })

        return AuditResult(
            passed=len(issues) == 0,
            issues=issues,
            recommendation=self._generate_recommendation(issues)
        )
```

### 4.2 ê°ì§€ íŒ¨í„´

| íŒ¨í„´ | ì„¤ëª… | ëŒ€ì‘ |
|------|------|------|
| **Style-Only Changes** | ì„¸ë¯¸ì½œë¡ , ë”°ì˜´í‘œ, ë“¤ì—¬ì“°ê¸°ë§Œ ë³€ê²½ | ê²½ê³  + ë¡¤ë°± ì œì•ˆ |
| **Import Reordering** | import ìˆœì„œ ë³€ê²½ | ë¬´ì‹œ (ìë™ í¬ë§·í„° í—ˆìš©) |
| **Comment Addition** | ë¶ˆí•„ìš”í•œ ì£¼ì„ ì¶”ê°€ | ê²½ê³  |
| **Variable Rename** | ê¸°ì¡´ ë™ì‘ ì½”ë“œì˜ ë³€ìˆ˜ëª… ë³€ê²½ | ê²½ê³  + ì •ë‹¹í™” ìš”êµ¬ |
| **Function Extraction** | ë‹¨ìˆœ ë²„ê·¸ ìˆ˜ì • ì‹œ í•¨ìˆ˜ ë¶„ë¦¬ | ê²½ê³  + ìŠ¹ì¸ í•„ìš” |
| **Type Annotation** | ê¸°ì¡´ JS â†’ TS íƒ€ì… ì¶”ê°€ | Secondary ìŠ¹ì¸ í•„ìš” |

### 4.3 Audit ë¦¬í¬íŠ¸ í˜•ì‹

```markdown
## Change Audit Report

### Summary
- Total files changed: 5
- In-scope changes: 3 âœ…
- Secondary scope (approved): 1 âš ï¸
- Issues detected: 1 âŒ

### Issues

#### âŒ OVER_REFACTORING in `features/auth/hooks/useAuth.ts`

| Line | Change Type | Issue |
|------|-------------|-------|
| 15-20 | Style | ë³€ìˆ˜ëª… `user` â†’ `currentUser` (ë¶ˆí•„ìš”) |
| 42 | Style | ì„¸ë¯¸ì½œë¡  ì¶”ê°€ (ë¶ˆí•„ìš”) |

**Recommendation**: ì´ ë³€ê²½ë“¤ì„ ë¡¤ë°±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

### Approved Changes

| File | Lines Changed | Reason |
|------|--------------|--------|
| features/auth/api/authApi.ts | +15 -3 | 2FA ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ |
| features/auth/types.ts | +8 -0 | 2FA íƒ€ì… ì •ì˜ |
| packages/types/src/auth.ts | +5 -0 | ê³µìœ  íƒ€ì… ì¶”ê°€ (ìŠ¹ì¸ë¨) |
```

---

## 5. AGENT_RULES.md ê°•í™”

### 5.1 í‘œì¤€ AGENT_RULES í…œí”Œë¦¿

```markdown
# AGENT_RULES.md - {Domain} Block

## Scope Definition

### Primary (ìë™ í—ˆìš©)
- `features/{domain}/**`

### Secondary (ëª…ì‹œì  ìŠ¹ì¸ í•„ìš”)
- `packages/types/src/{domain}.ts`
- `backend/src/services/{domain}.py`

### Forbidden (ì ˆëŒ€ ê¸ˆì§€)
- `features/auth/**` (ë‹¤ë¥¸ ë„ë©”ì¸)
- `*.config.*` (ì„¤ì • íŒŒì¼)
- `index.ts` (barrel export - ì‹ ì¤‘í•˜ê²Œ)

---

## DO (í•´ì•¼ í•  ê²ƒ)

1. âœ… **ìš”ì²­ëœ ê¸°ëŠ¥ë§Œ êµ¬í˜„**
   - ì¶”ê°€ "ê°œì„ " ê¸ˆì§€
   - ë¦¬íŒ©í† ë§ì€ ë³„ë„ ì‘ì—…ìœ¼ë¡œ

2. âœ… **ìµœì†Œ ë³€ê²½ ì›ì¹™**
   - í•œ íŒŒì¼ë‹¹ ìµœëŒ€ 50ì¤„ ë³€ê²½ ê¶Œì¥
   - 50ì¤„ ì´ˆê³¼ ì‹œ ë¶„í•  ê²€í† 

3. âœ… **ë³€ê²½ ì •ë‹¹í™”**
   - ëª¨ë“  íŒŒì¼ ìˆ˜ì •ì— ì´ìœ  ëª…ì‹œ
   - "ì™œ ì´ íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ”ê°€?"

---

## DON'T (í•˜ì§€ ë§ ê²ƒ)

1. âŒ **ë²”ìœ„ ì™¸ íŒŒì¼ ìˆ˜ì •**
   - Primary/Secondary ì™¸ íŒŒì¼ ìˆ˜ì • ê¸ˆì§€
   - í•„ìš” ì‹œ ì‚¬ìš©ìì—ê²Œ ìŠ¹ì¸ ìš”ì²­

2. âŒ **ìŠ¤íƒ€ì¼ í†µì¼ ìˆ˜ì •**
   - ê¸°ì¡´ ì½”ë“œ ìŠ¤íƒ€ì¼ ë³€ê²½ ê¸ˆì§€
   - ì„¸ë¯¸ì½œë¡ , ë”°ì˜´í‘œ, ë“¤ì—¬ì“°ê¸° ìˆ˜ì • ê¸ˆì§€

3. âŒ **ë¶ˆí•„ìš”í•œ ë¦¬íŒ©í† ë§**
   - ë™ì‘í•˜ëŠ” ì½”ë“œ "ê°œì„ " ê¸ˆì§€
   - ë³€ìˆ˜ëª… ë³€ê²½ ê¸ˆì§€ (ëª…ì‹œì  ìš”ì²­ ì œì™¸)

4. âŒ **ì£¼ì„ ë‚¨ë°œ**
   - ë¶ˆí•„ìš”í•œ ì£¼ì„ ì¶”ê°€ ê¸ˆì§€
   - "// TODO", "// FIXME" ë‚¨ë°œ ê¸ˆì§€

5. âŒ **Import ì •ë¦¬**
   - ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” import ì œê±°ëŠ” OK
   - import ìˆœì„œ ì¬ì •ë ¬ ê¸ˆì§€

---

## Change Checklist (ì»¤ë°‹ ì „)

- [ ] Primary ë²”ìœ„ ë‚´ íŒŒì¼ë§Œ ìˆ˜ì •í–ˆëŠ”ê°€?
- [ ] Secondary íŒŒì¼ ìˆ˜ì • ì‹œ ìŠ¹ì¸ ë°›ì•˜ëŠ”ê°€?
- [ ] ê° íŒŒì¼ ë³€ê²½ì— ëª…í™•í•œ ì´ìœ ê°€ ìˆëŠ”ê°€?
- [ ] ìš”ì²­ë˜ì§€ ì•Šì€ "ê°œì„ "ì´ í¬í•¨ë˜ì§€ ì•Šì•˜ëŠ”ê°€?
- [ ] ì½”ë“œ ìŠ¤íƒ€ì¼ë§Œ ë³€ê²½ëœ ë¼ì¸ì´ ì—†ëŠ”ê°€?
```

---

## 6. Block êµ¬ì¡° ê°•í™”

### 6.1 í™ˆí˜ì´ì§€ ë„ë©”ì¸ ë¸”ëŸ­ ìƒì„±

```
apps/web/features/home/
â”œâ”€â”€ AGENT_RULES.md          # ğŸ›¡ï¸ ë²”ìœ„ ì œì•½ì‚¬í•­
â”œâ”€â”€ types.ts                # íƒ€ì… ì •ì˜
â”œâ”€â”€ index.ts                # Public API
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ HomePage.svelte     # ë©”ì¸ í˜ì´ì§€
â”‚   â”œâ”€â”€ ContentRow.svelte   # Row ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ ContentCard.svelte  # ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ api/
â”‚   â””â”€â”€ homeApi.ts          # API í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useHome.ts          # í™ˆ ë°ì´í„° í›…
â””â”€â”€ stores/
    â””â”€â”€ homeStore.ts        # í™ˆ ìƒíƒœ ê´€ë¦¬
```

### 6.2 features/home/AGENT_RULES.md

```markdown
# AGENT_RULES.md - Home Block

> Netflix ìŠ¤íƒ€ì¼ ë™ì  Row ê¸°ë°˜ í™ˆí˜ì´ì§€ ë„ë©”ì¸

## Scope Definition

### Primary (ìë™ í—ˆìš©)
```
features/home/**
```

### Secondary (ëª…ì‹œì  ìŠ¹ì¸ í•„ìš”)
```
packages/types/src/home.ts
backend/src/api/v1/home.py
backend/src/services/row_service.py
```

### Forbidden (ì ˆëŒ€ ê¸ˆì§€)
```
features/auth/**
features/player/**
features/search/**
backend/src/api/v1/jellyfin.py  # ì½ê¸°ë§Œ í—ˆìš©, ìˆ˜ì • ê¸ˆì§€
```

---

## DO

1. âœ… Row ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œë§Œ ì‘ì—…
2. âœ… types.ts ë¨¼ì € ìˆ˜ì • í›„ ì»´í¬ë„ŒíŠ¸ ì‘ì—…
3. âœ… Jellyfin APIëŠ” í˜¸ì¶œë§Œ (ìˆ˜ì • ê¸ˆì§€)

## DON'T

1. âŒ Jellyfin ì„œë¹„ìŠ¤ ì§ì ‘ ìˆ˜ì •
2. âŒ Auth/Player/Search ë¸”ëŸ­ ì ‘ê·¼
3. âŒ ê³µìœ  UI ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •

---

## Dependencies

| ì˜ì¡´ ëŒ€ìƒ | ê´€ê³„ | ìˆ˜ì • ê°€ëŠ¥ |
|----------|------|----------|
| `@wsoptv/types` | import | Secondary |
| `features/auth` | í˜¸ì¶œ (authStore) | âŒ ì½ê¸°ë§Œ |
| `jellyfin API` | í˜¸ì¶œ | âŒ ì½ê¸°ë§Œ |

## Testing

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
npm run test:unit features/home/

# E2E í…ŒìŠ¤íŠ¸
npx playwright test e2e/specs/home/
```
```

---

## 7. ì‹¤í–‰ íë¦„ í†µí•©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Full Isolation Workflow                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  User Request: "í™ˆí˜ì´ì§€ì— Trending Row ì¶”ê°€"                             â”‚
â”‚       â”‚                                                                   â”‚
â”‚       â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚  Orchestrator   â”‚ â†’ Domain: "home"                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚           â”‚                                                               â”‚
â”‚           â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚  Scope Guard    â”‚                                                     â”‚
â”‚  â”‚                 â”‚                                                     â”‚
â”‚  â”‚  ì˜ˆìƒ ìˆ˜ì • íŒŒì¼:                                                       â”‚
â”‚  â”‚  â”œâ”€ features/home/types.ts      âœ… Primary                           â”‚
â”‚  â”‚  â”œâ”€ features/home/api/homeApi.ts âœ… Primary                          â”‚
â”‚  â”‚  â”œâ”€ features/home/components/    âœ… Primary                          â”‚
â”‚  â”‚  â”œâ”€ backend/src/services/row.py  âš ï¸ Secondary â†’ ìŠ¹ì¸ ìš”ì²­            â”‚
â”‚  â”‚  â””â”€ backend/src/api/v1/jellyfin.py âŒ Forbidden â†’ ì°¨ë‹¨               â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â”‚  "jellyfin.py ìˆ˜ì •ì´ í•„ìš”í•˜ë‹¤ë©´ ë³„ë„ ì´ìŠˆë¡œ ì§„í–‰í•˜ì„¸ìš”"               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚           â”‚                                                               â”‚
â”‚           â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚  Domain Agent   â”‚ â†’ ìŠ¹ì¸ëœ ë²”ìœ„ ë‚´ì—ì„œë§Œ ì‘ì—…                         â”‚
â”‚  â”‚  (home-domain)  â”‚                                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚           â”‚                                                               â”‚
â”‚           â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚ Change Auditor  â”‚                                                     â”‚
â”‚  â”‚                 â”‚                                                     â”‚
â”‚  â”‚  ì‹¤ì œ ë³€ê²½ ë¶„ì„:                                                       â”‚
â”‚  â”‚  â”œâ”€ types.ts: +15ì¤„ (ìƒˆ íƒ€ì…)     âœ… OK                              â”‚
â”‚  â”‚  â”œâ”€ homeApi.ts: +20ì¤„ (ìƒˆ API)    âœ… OK                              â”‚
â”‚  â”‚  â”œâ”€ ContentRow.svelte: +5ì¤„       âœ… OK                              â”‚
â”‚  â”‚  â””â”€ HomePage.svelte: +3ì¤„, -2ì¤„   âš ï¸ ìŠ¤íƒ€ì¼ ë³€ê²½ ê°ì§€                â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â”‚  "HomePage.svelteì˜ ìŠ¤íƒ€ì¼ë§Œ ë³€ê²½ëœ 2ì¤„ì„ ë¡¤ë°±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚           â”‚                                                               â”‚
â”‚           â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚     Commit      â”‚ â†’ ê¹¨ë—í•œ ë³€ê²½ë§Œ ì»¤ë°‹                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Implementation Phases

### Phase 1: AGENT_RULES ê°•í™” (ì¦‰ì‹œ)
- [ ] ê° ë„ë©”ì¸ ë¸”ëŸ­ì— ê°•í™”ëœ AGENT_RULES.md ì ìš©
- [ ] Scope Definition ì„¹ì…˜ ì¶”ê°€
- [ ] Change Checklist ì¶”ê°€

### Phase 2: Scope Guard (1ì£¼)
- [ ] `scope-guard-agent.md` ì‘ì„±
- [ ] domain-scopes.yaml ì •ì˜
- [ ] Orchestratorì— Scope Guard í†µí•©

### Phase 3: Change Auditor (2ì£¼)
- [ ] `change-auditor-agent.md` ì‘ì„±
- [ ] diff ë¶„ì„ ë¡œì§ êµ¬í˜„
- [ ] Audit Report í˜•ì‹ ì •ì˜

### Phase 4: ìë™í™” (3ì£¼)
- [ ] pre-commit hookìœ¼ë¡œ Scope ê²€ì¦
- [ ] PR ìƒì„± ì‹œ ìë™ Audit
- [ ] ìœ„ë°˜ ì‹œ ìë™ ë¡¤ë°± ì œì•ˆ

---

## 9. Related Documents

| ë¬¸ì„œ | ì„¤ëª… |
|------|------|
| `docs/architecture/0001-block-agent-system.md` | Block Agent ê¸°ë³¸ ì„¤ê³„ |
| `.claude/agents/orchestrator.md` | Orchestrator ê·œì¹™ |
| `docs/architecture/0002-netflix-dynamic-catalog-system.md` | í™ˆí˜ì´ì§€ ì„¤ê³„ |
